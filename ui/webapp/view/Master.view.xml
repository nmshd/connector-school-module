<mvc:View
    controllerName="eu.enmeshed.connectorui.controller.Master"
    xmlns="sap.m"
    xmlns:f="sap.f"
    xmlns:t="sap.ui.table"
    xmlns:mvc="sap.ui.core.mvc"
>
    <f:DynamicPage
        id="masterPage"
        stickySubheaderProvider="iconTabBar"
        class="sapUiNoContentPadding"
    >
        <!-- DynamicPage Title -->
        <f:title>
            <f:DynamicPageTitle>
                <f:heading>
                    <Title
                        text="{i18n>appTitle} für Schule {app>/schoolModuleConfig/schoolName}"
                        level="H2"
                    />
                </f:heading>
                <f:actions>
                    <Button
                        icon="sap-icon://refresh"
                        text="Aktualisieren"
                        tooltip="Aktualisiert die Liste der Schüler"
                        press=".onRefresh"
                    />
                    <Button
                        icon="sap-icon://upload"
                        text="Importieren"
                        tooltip="Importiert eine Schülerliste"
                        press=".onOpenAddStudentsDialog"
                    />
                    <Button
                        icon="sap-icon://excel-attachment"
                        text="CSV Export"
                        tooltip="Exportiert die Liste der Schüler als CSV"
                        press=".onDownloadCSV"
                    />
                    <Button
                        icon="sap-icon://excel-attachment"
                        text="XLSX Export"
                        tooltip="Exportiert die Liste der Schüler als XLSX"
                        press=".onDownloadXLSX"
                    />

                    <Button
                        text="Abmelden"
                        icon="sap-icon://log"
                        press=".logout"
                    />
                </f:actions>
            </f:DynamicPageTitle>
        </f:title>

        <f:content>
            <t:Table
                id="table"
                rows="{
						path: 'studentModel>/students',
						sorter: {
							path: 'Name'
						}
					}"
                class="sapFDynamicPageAlignContent"
                width="auto"
                rowSelectionChange=".onRowSelectionChange"
                busyIndicatorDelay="0"
                visibleRowCountMode="Auto"
            >
                <t:extension>
                    <OverflowToolbar>
                        <Title text="Liste aller vorhandenen Schüler in der Ablage" />
                        <ToolbarSpacer />
                        <Button
                            text="Schüler hinzufügen"
                            icon="sap-icon://add"
                            press=".onOpenAddStudentDialog"
                        />
                        <Button
                            text="Sammeldokument erstellen"
                            icon="sap-icon://pdf-attachment"
                            tooltip="Erstellt eine PDF Datei mit allen Onboarding Dokumenten der selektierten Schüler"
                            press=".downloadStudents"
                        />
                        <Button
                            icon="sap-icon://delete"
                            type="Reject"
                            text="Schüler löschen"
                            press=".onDeleteSelectedStudents"
                            tooltip="Löscht die selektierten Schüler"
                            visible="{= ${ui>/selectedItemCount} > 0}"
                        />
                        <ToolbarSeparator />
                        <SearchField
                            placeholder="Search"
                            value="{ui>/globalFilter}"
                            search="searchTable"
                            width="15rem" />
                    </OverflowToolbar>
                </t:extension>
                <t:columns>
                    <t:Column id="id" width="6em" sortProperty="id" filterProperty="id"
                        resizable="true">
                        <Label text="Schüler ID" />
                        <t:template>
                            <Text text="{studentModel>id}" />
                        </t:template>
                    </t:Column>
                    <t:Column id="givenname" sortProperty="givenname" filterProperty="givenname"
                        resizable="true">
                        <Text text="Vorname" />
                        <t:template>
                            <Text
                                text="{studentModel>givenname}"
                            />
                        </t:template>
                    </t:Column>
                    <t:Column id="surname" sortProperty="surname" filterProperty="surname"
                        resizable="true">
                        <Text text="Nachname" />
                        <t:template>
                            <Text
                                text="{studentModel>surname}"
                            />
                        </t:template>
                    </t:Column>
                    <t:Column id="pin" width="4em" sortProperty="pin" resizable="true">
                        <Text text="PIN" />
                        <t:template>
                            <Text text="{studentModel>pin}"
                                visible="{=${studentModel>status} === 'onboarding'}" />
                        </t:template>
                    </t:Column>
                    <t:Column id="status" width="20em" sortProperty="status">
                        <Text text="Status" />
                        <t:template>
                            <Text text="{path:'studentModel>status',formatter:'.formatStatus'}" />
                        </t:template>
                    </t:Column>
                    <t:Column width="27em">
                        <Text text="Aktionen pro Schüler" />
                        <t:template>
                            <HBox columnGap="0.25em">
                                <Button
                                    icon="sap-icon://pdf-attachment"
                                    text="Dokument"
                                    press=".onDownloadPdf"
                                    enabled="{= (${studentModel>status} === 'onboarding')}"
                                    tooltip="{= (${studentModel>status} === 'onboarding' ? 'Ein PDF Dokument für das Onboarding des Schülers erzeugen' : 'Dieser Schüler ist aktiv, sie können kein Onboarding Dokument mehr erzeugen')}" />
                                <Button
                                    icon="sap-icon://qr-code"
                                    text="QR Code"
                                    press=".onStudentQR"
                                    enabled="{= (${studentModel>status} === 'onboarding')}"
                                    tooltip="{= (${studentModel>status} === 'onboarding' ? 'Ein PDF Dokument für das Onboarding des Schülers erzeugen' : 'Dieser Schüler ist aktiv, sie können kein Onboarding Dokument mehr erzeugen')}" />
                                <Button
                                    icon="sap-icon://inspect"
                                    text="Log"
                                    press=".onStudentLog"
                                    enabled="{= (${studentModel>status} !== 'deleted')}"
                                    tooltip="{= (${studentModel>status} === 'deleted' ? 'Ein gelöschter Schüler besitzt keinen Log mehr.' : 'Zur Fehlerbehandlung, den Log des Schülers aufrufen.')}" />
                                <Button
                                    icon="sap-icon://inspect"
                                    text="Zeugnis hochladen"
                                    press=".onSendZeugnis"
                                    visible="false"
                                    enabled="{= ${studentModel>status} === 'active' }"
                                    tooltip="{= (${studentModel>status} !== 'active' ? 'Nur Schüler mit einer aktiven Beziehung können ein Zeugnis erhalten' : 'Zeugnis für einen Schüler hochladen')}" />

                            </HBox>
                        </t:template>
                    </t:Column>
                </t:columns>
            </t:Table>
        </f:content>
    </f:DynamicPage>
</mvc:View>