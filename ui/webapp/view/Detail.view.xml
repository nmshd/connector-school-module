<mvc:View
    controllerName="eu.enmeshed.connectorui.controller.Detail"
    xmlns="sap.m"
    xmlns:f="sap.f"
    xmlns:mvc="sap.ui.core.mvc"
    binding="{ path: 'detailView>/detailStudent' }"
>
    <f:DynamicPage
        id="detailPage"
        stickySubheaderProvider="iconTabBar"
        class="sapUiNoContentPadding"
        busy="{detailView>/busy}"
        toggleHeaderOnTitleClick="false"
        preserveHeaderStateOnScroll="true"
        busyIndicatorDelay="{detailView>/delay}"
    >
        <f:title>
            <f:DynamicPageTitle>
                <f:heading>
                    <Title
                        text="{detailView>givenname} {detailView>surname}"
                        level="H2"
                    />
                </f:heading>
                <f:navigationActions>
                    <OverflowToolbarButton
                        type="Transparent"
                        icon="sap-icon://refresh"
                        press=".onRefresh"
                    />
                    <OverflowToolbarButton
                        type="Transparent"
                        icon="sap-icon://decline"
                        press=".handleClose"
                    />
                </f:navigationActions>
            </f:DynamicPageTitle>
        </f:title>
        <f:header>
            <f:DynamicPageHeader pinnable="true">
                <HBox justifyContent="SpaceBetween">
                    <VBox>
                        <ObjectAttribute
                            title="ID"
                            text="{detailView>id}"
                        />
                        <ObjectAttribute
                            title="Status"
                            text="{path:'detailView>status',formatter:'.formatter.formatStatus'}"
                        />
                        <ObjectAttribute
                            title="Pin"
                            text="{detailView>pin}"
                            visible="{=${detailView>status} === 'onboarding'}"
                        />
                    </VBox>
                    <VBox>
                        <Image
                            width="150px"
                            height="150px"
                            id="detailqrcode"
                            visible="{= (${detailView>status} === 'onboarding')}"
                            src="{detailView>/studentQR}"
                        />
                        <Button
                            icon="sap-icon://pdf-attachment"
                            text="Dokument"
                            press=".onDownloadPdf($event, 'detailView')"
                            enabled="{= (${detailView>status} === 'onboarding')}"
                            tooltip="{= (${detailView>status} === 'onboarding' ? 'Ein PDF Dokument für das Onboarding des Schülers erzeugen' : 'Dieser Schüler ist aktiv, sie können kein Onboarding Dokument mehr erzeugen')}"
                        />
                    </VBox>
                </HBox>
            </f:DynamicPageHeader>
        </f:header>
        <f:content>
            <VBox>
                <Panel
                    width="auto"
                    class="sapUiResponsiveMargin"
                    accessibleRole="Region"
                >
                    <headerToolbar>
                        <OverflowToolbar>
                            <Title text="Gesendete Dateien" />
                            <ToolbarSpacer />
                            <Button
                                icon="sap-icon://inspect"
                                text="Zeugnis hochladen"
                                press=".onSendZeugnis($event, 'detailView')"
                                enabled="{= ${detailView>status} === 'active' }"
                                tooltip="{= (${detailView>status} !== 'active' ? 'Nur Schüler mit einer aktiven Beziehung können ein Zeugnis erhalten' : 'Zeugnis für einen Schüler hochladen')}"
                            />
                        </OverflowToolbar>
                    </headerToolbar>
                    <content>
                        <Table items="{detailView>/files}">
                            <columns>
                                <Column>
                                    <Text text="Dateiname" />
                                </Column>
                                <Column>
                                    <Text text="Status" />
                                </Column>
                                <Column>
                                    <Text text="Versand Datum" />
                                </Column>
                                <Column>
                                    <Text text="Antwort Datum" />
                                </Column>
                            </columns>
                            <items>
                                <ColumnListItem>
                                    <cells>
                                        <Text text="{detailView>filename}" />
                                        <Text
                                            text="{path:'detailView>status',formatter:'.formatter.formatFileStatus'}"
                                        />
                                        <Text
                                            text="{path:'detailView>fileSentAt',formatter:'.formatter.formateDate'}"
                                        />
                                        <Text
                                            text="{path:'detailView>respondedAt',formatter:'.formatter.formateDate'}"
                                        />
                                    </cells>
                                </ColumnListItem>
                            </items>
                        </Table>
                    </content>
                </Panel>
                <Panel
                    width="auto"
                    class="sapUiResponsiveMargin"
                    accessibleRole="Region"
                >
                    <headerToolbar>
                        <OverflowToolbar>
                            <Title text="Log" />
                        </OverflowToolbar>
                    </headerToolbar>
                    <content>
                        <TextArea
                            rows="20"
                            width="100%"
                            id="detaillogOutput"
                            value="{detailView>/logOutput}"
                            editable="false"
                        />
                    </content>
                </Panel>
            </VBox>
        </f:content>
    </f:DynamicPage>
</mvc:View>
